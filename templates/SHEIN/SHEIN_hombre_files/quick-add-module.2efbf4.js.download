(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{"6rzJ":function(t,a,i){"use strict";var d=function(t){return t&&t.__esModule?t:{default:t}}(i("UF36"));var e=gbSsrData.language,n=gbCommonInfo,o=n.lang,s=n.currency,r=n.GB_cssRight;window.quick_add={data:{goods_data:{},loading:{},limit_tip:null},controller:{},define_reactive_controller:function(t){var a=this.controller[t]={id:t};Object.defineProperty(a,"show_quick_add_ctn",{set:function(t){var a=this;this._show_quick_add_ctn=t,t?($(".j-btn-add-to-bag-"+a.id).addClass("she-hide"),$(".j-absolute-quick-add-"+a.id).show().find(".j-quick-add-ctn").addClass("animated slideInUp").one("animationend",function(){$(this).removeClass("animated slideInUp")})):($(".j-absolute-quick-add-"+a.id).find(".j-quick-add-ctn").addClass("animated slideOutDown").one("animationend",function(){$(".j-absolute-quick-add-"+a.id).hide(),$(this).removeClass("animated slideOutDown")}),$(".j-btn-add-to-bag-"+a.id).removeClass("she-hide"))}}),Object.defineProperty(a,"show_quick_add_mask",{set:function(a){this._show_quick_add_mask=a,a?($(".j-btn-add-to-bag-"+this.id).addClass("she-hide"),$(".j-add-result-mask-"+t).fadeIn("300")):($(".j-add-result-mask-"+t).fadeOut("300"),$(".j-btn-add-to-bag-"+this.id).removeClass("she-hide"))}}),Object.defineProperty(a,"quick_adding",{set:function(a){this._quick_adding=a,a?$(".j-add-result-mask-"+t).find(".j-la-ball-pulse").show():$(".j-add-result-mask-"+t).find(".j-la-ball-pulse").hide()}}),Object.defineProperty(a,"quick_result",{set:function(a){this._quick_result=a,a&&$(".j-add-result-mask-"+t).find(".j-result-txt").html(a)}}),Object.defineProperty(a,"show_quick_result",{set:function(a){this._show_quick_result=a,a?$(".j-add-result-mask-"+t).find(".j-result-txt").show():$(".j-add-result-mask-"+t).find(".j-result-txt").hide()}}),Object.defineProperty(a,"show_stock_error",{set:function(t){this._show_stock_error=t,t&&$(".j-absolute-quick-add-"+this.id).find(".j-stock-error").show().next(".j-quick-add-opt-ctn").hide()}}),Object.defineProperty(a,"show_quick_add_loading",{set:function(t){this._show_quick_add_loading=t,t?$(".j-btn-add-to-bag-"+this.id).addClass("qa-loading"):$(".j-btn-add-to-bag-"+this.id).removeClass("qa-loading")}})},init:function(t){this.data.goods_data=t,this.bind_event(),this.init_cart_limit_tip_vue()},bind_event:function(){var t=this;$(document).on("au"!=o?"click":"mouseenter",".j-btn-add-to-bag",function(a){var i=$(this);$(".j-add-bag-submit")&&($(".j-add-bag-submit").hasClass("disabled")&&$(".j-add-bag-submit").removeClass("disabled"),$(".j-add-bag-submit").attr("disabled")&&$(".j-add-bag-submit").removeAttr("disabled")),i.hasClass("j-btn-add-to-bag-no-attr")||t.open_quick_add(i,i.data("id"))}).on("click",".j-quick-add-opt",function(a){var i=$(this);+$(this).children(".opt").attr("data-stock")<=0?($(".j-add-bag-submit").hasClass("disabled")||$(".j-add-bag-submit").addClass("disabled"),$(".j-add-bag-submit").attr("disabled")||$(".j-add-bag-submit").attr("disabled","true")):($(".j-add-bag-submit").hasClass("disabled")&&$(".j-add-bag-submit").removeClass("disabled"),$(".j-add-bag-submit").attr("disabled")&&$(".j-add-bag-submit").removeAttr("disabled")),t.click_size(i.data("id"),i.data("index"))}).on("click",".j-add-bag-submit",function(a){var i=$(this);t.submit_quick_add(this,i.data("id"),"hasAttr")}).on("click",".j-add-bag-cancel",function(a){t.controller[$(this).data("id")].show_quick_add_ctn=!1}),"au"==o&&$(document).on("change",".j-quick-add-opt input",function(a){var i=$(this).data("id");t.submit_quick_add($(".j-add-bag-submit-"+i)[0],i,"hasAttr")}).on("click",".j-btn-add-to-bag-no-attr",function(a){var i=$(this).data("id");t.submit_quick_add($(".j-add-bag-submit-"+i)[0],i,"noAttr")})},open_quick_add:function(t,a){var i=this,e=i.data.goods_data[a];if(e.front_end_data&&e.front_end_data.quick_add_info||i.data.loading[a])e.front_end_data&&e.front_end_data.quick_add_info&&("au"==o&&$(".j-quick-add-opt-"+a+" .j-quick-add-opt input:checked").removeAttr("checked"),i.controller[a].show_quick_add_ctn=!0);else{i.data.loading[a]=!0,i.define_reactive_controller(a),$.when(function(){var t=$.Deferred();return $.ajax({url:"/product/attr",data:{id:a}}).done(function(a){t.resolve(a)}).always(function(){i.data.loading[a]=!1,t.resolve()}),t.promise()}(),function(){var t=$.Deferred();return $.ajax({url:"/product/getSizeRules",data:{goods_ids:a}}).done(function(a){t.resolve(a)}).fail(function(a){t.resolve()}),t.promise()}()).then(function(n,s){n&&0==n.code?(n.info.attrSize=n.info.attrSize.filter(function(t){return!!(t.price&&t.price.salePrice&&t.price.retailPrice)}),s&&0==s.code&&s.info&&s.info[a]&&Array.isArray(s.info[a].size_rule_list)&&s.info[a].size_rule_list.length>0&&$(".j-quick-add-opt-"+a).parents(".j-quick-add-ctn").addClass("n-quick-add-ctn"),$(".j-quick-add-opt-"+a).append(ejs.compile(d.default,{client:!0,delimiter:"$"})({quick_add_info:n.info.attrSize,size_rule:s&&s.info[a]||{},goods_id:a,GB_cssRight:r},null,function(t,a){})),1==n.info.attrSize.length?t.find(".j-quick-add-opt").click():0==n.info.attrSize.length&&(i.controller[a].show_stock_error=!0),i.controller[a].show_quick_add_ctn=!0,e.front_end_data||(e.front_end_data={}),e.front_end_data.quick_add_info=n.info.attrSize,e.front_end_data.size_rule=s&&s.info[a]||null):n&&200302==n.code&&("au"!=o?i.submit_quick_add($(".j-add-bag-submit-"+a)[0],a,"noAttr"):t.hasClass("j-btn-add-to-bag-no-attr")||t.addClass("j-btn-add-to-bag-no-attr"))})}},submit_quick_add:function(t,a,i){var d,n=this,r=$(".j-quick-add-opt-"+a),l={};if(!n.controller[a].quick_adding){if(0==r.find("input:checked").length&&"noAttr"!==i)return r.addClass("animated animate-shake").one("animationend",function(){r.removeClass("animated animate-shake")}),void("undefined"!=typeof gaEventCenter&&gaEventCenter.$emit("addBag",{el:t,quantity:1,value:0}));"noAttr"!==i&&(l=n.data.goods_data[a].front_end_data.quick_add_info[r.find("input:checked").data("index")]),d={goods_id:a,quantity:1,attrs:[{attr_id:l.attr_id||"",attr_value_id:l.attr_value_id||""}]};var c=gbExposeTraceid("getComponent",{componentName:"goodslist"});c&&(d.trace_id=c),n.controller[a].show_quick_add_ctn=!1,n.controller[a].show_quick_add_mask=!0,n.controller[a].quick_adding=!0,$.ajax({url:"/cart/add",type:"POST",data:d}).done(function(i){0==i.code&&i.info?(cart_module.recart(i),n.controller[a].quick_result=e.lang_category_added_successfully,gaEventCenter.$emit("addBag",{el:t,quantity:1,value:1,size:d.attrs[0].attr_value_id}),"undefined"!=typeof doFbq&&doFbq("AddToCart",{content_name:"Shopping Cart",content_ids:a}),"function"==typeof mkq&&mkq("track","AddToCart",{content_name:n.data.goods_data[a].goods_name,content_ids:[a],content_type:"product",value:n.data.goods_data[a].salePrice.amount,currency:s}),"us"===o&&window.pintrk_cart_add&&pintrk_cart_add({data:i,goods_id:d.goods_id,order_quantity:d.quantity,currency:window.gbCommonInfo&&gbCommonInfo.currency||""}),window.branchEvent&&window.branchEvent.addToCart({sku:d.goods_id,quantity:d.quantity})):(200401==i.code||500301==i.code?n.controller[a].quick_result=e.lang_goods_only_one:300402==i.code?n.controller[a].quick_result=e.lang_goods_out_stock:500302==i.code?n.controller[a].quick_result=SHEIN_W.template(i.info.limitCount,e.lang_goods_limit_buy):500303==i.code?n.controller[a].quick_result=e.SHEIN_PC_KEY_3274:300407==i.code?(n.data.limit_tip.cartLimitTips=!0,setTimeout(function(){n.data.limit_tip.cartLimitTips=!1},2e3)):n.controller[a].quick_result=e.lang_goods_error,gaEventCenter.$emit("addBag",{el:t,quantity:1,value:0}))}).always(function(){n.controller[a].quick_adding=!1,n.controller[a].show_quick_result=!0,setTimeout(function(){n.controller[a].show_quick_result=!1,n.controller[a].show_quick_add_mask=!1},1e3)})}},click_size:function(t,a){var i=this.data.goods_data[t],d=this.data.goods_data[t].front_end_data.quick_add_info[a].price;i.salePrice.amount==d.salePrice.amount&&i.retailPrice.amount==d.retailPrice.amount||($(".j-gds-li-price-"+t+", .j-gds-li-price-"+t+" .j-price-discount, .j-gds-li-discount-"+t).removeClass("will-show she-show she-inline-block"),GB_SHEIN_goods_list.update_one_price(t,this.data.goods_data[t].front_end_data.quick_add_info[a].price),$(".j-gds-li-price-"+t+", .j-gds-li-discount-"+t+".will-show").addClass("she-show"),$(".j-gds-li-price-"+t+" .will-show").addClass("she-inline-block"))},init_cart_limit_tip_vue:function(){this.data.limit_tip=new Vue({el:".j-quick-add-cart-limit-tip",data:{cartLimitTips:!1}})}},quick_add.init(GB_SHEIN_goods_list.data.goods_data_obj)},UF36:function(t,a){t.exports='<$ if (quick_add_info) { $>\n    <$ if (size_rule && size_rule.size_rule_list && size_rule.size_rule_list.length > 0){ $>\n        <div class="c-opt">\n            <div class="size-row">\n                <$ quick_add_info.forEach(function(item, index,arr) { $>\n                    <div class="size-item">\n                        <$ if (index == 0){ $>\n                            <span class="location-rule">(<$=size_rule.country_code $>)</span>\n                        <$ } $>\n                        <label class="opt-size j-quick-add-opt" data-id="<$=goods_id$>" data-index="<$=index$>">\n                            <input class="opt"\n                                type="radio"\n                                name="size<$=goods_id$>"\n                                value="<$=index$>"\n                                data-id="<$=goods_id$>"\n                                data-stock="<$=item.stock$>"\n                                data-index="<$=index$>"\n                                >\n                            <span class="opt-real <$ if(item.attr_value && item.attr_value.length>2 || item.attr_std_value) { $>opt-long-txt<$ } $>  <$ if (item.stock <= 0) { $>size-sold-out sold-out<$ }  $>">\n                                <$ if (item.attr_std_value){ $>\n                                    <$ if(GB_cssRight){ $>\n                                        <$=item.attr_value$> / <strong><$=item.attr_std_value$></strong>\n                                    <$ }else{ $>\n                                        <strong><$=item.attr_std_value$></strong> / <$=item.attr_value$>\n                                    <$ } $>\n                                <$ }else{ $>\n                                    <$=item.attr_value$>\n                                <$ } $>\n                            </span>\n                        </label>\n                        <span class="location-size">\n                        <$ size_rule.size_rule_list.forEach(function(locationsize) { $>\n                            <$ if (locationsize.name == item.attr_value_en){ $>\n                                <$=locationsize.correspond$>\n                            <$ } $>\n                        <$ }) $>\n                        </span>\n                    </div>\n                <$ }) $>\n            </div>\n        </div>\n    <$ }else{ $>\n        <div class="c-opt">\n            <$ quick_add_info.forEach(function(item, index) { $>\n                <label class="opt-size j-quick-add-opt" data-id="<$=goods_id$>" data-index="<$=index$>">\n                    <input class="opt"\n                        type="radio"\n                        name="size<$=goods_id$>"\n                        value="<$=index$>"\n                        data-id="<$=goods_id$>"\n                        data-stock="<$=item.stock$>"\n                        data-index="<$=index$>"\n                        >\n                    <span class="opt-real <$ if(item.attr_value && item.attr_value.length>2 || item.attr_std_value) { $>opt-long-txt<$ } $>  <$ if (item.stock <= 0) { $>size-sold-out sold-out<$ }  $>">\n                        <$ if (item.attr_std_value){ $>\n                            <$ if(GB_cssRight){ $>\n                                <$=item.attr_value$> / <strong><$=item.attr_std_value$></strong>\n                            <$ }else{ $>\n                                <strong><$=item.attr_std_value$></strong> / <$=item.attr_value$>\n                            <$ } $>\n                        <$ }else{ $>\n                            <$=item.attr_value$>\n                        <$ } $>\n                    </span>\n                </label>\n            <$ }) $>\n        </div>\n    <$ } $>\n<$ } $>\n'}}]);
//# sourceMappingURL=quick-add-module.2efbf4.js.map